<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ç¡®è®¤ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; background-color: #f5f5f5; line-height: 1.8; }
        .container { max-width: 900px; margin: 20px auto; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba( 0, 0, 0, 0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #1a56db 0%, #1e3a8a 100%); color: white; text-align: center; padding: 30px 20px; }
        .header h1 { font-size: 24px; margin-bottom: 10px; }
        .content-section { padding: 30px; }
        .text-content { background: #fafafa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 30px; margin-bottom: 20px; max-height: 500px; overflow-y: auto; font-size: 16px; }
        .text-content h3 { color: #1e3a8a; text-align: center; margin-bottom: 25px; font-size: 22px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0; }
        .text-content h4 { color: #1a56db; margin: 20px 0 15px 0; font-size: 18px; padding-left: 10px; border-left: 4px solid #1a56db; }
        .text-content p { margin-bottom: 15px; color: #444; text-indent: 2em; line-height: 1.8; }
        .text-content strong { color: #dc2626; font-weight: 600; }
        .read-complete-btn { display: block; width: 240px; margin: 30px auto 20px; padding: 14px 24px; background: #1a56db; color: white; border: none; border-radius: 6px; font-size: 17px; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .read-complete-btn:hover { background: #1e40af; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .signature-section { display: none; text-align: center; padding: 20px 0; }
        .signature-title { color: #333; margin-bottom: 25px; font-size: 21px; }
        .signature-area { border: 2px dashed #94a3b8; border-radius: 8px; margin: 20px auto; background: #f8fafc; width: 90%; max-width: 650px; }
        #signatureCanvas { display: block; margin: 0 auto; cursor: crosshair; border-radius: 6px; }
        .signature-controls { margin: 20px 0; }
        .btn { padding: 10px 22px; margin: 0 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; transition: all 0.3s; font-weight: 500; }
        .clear-btn { background: #ef4444; color: white; }
        .clear-btn:hover { background: #dc2626; }
        .submit-section { display: none; text-align: center; padding: 40px 20px; }
        .confirmation-message { background: #dcfce7; color: #166534; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #bbf7d0; font-size: 17px; }
        .final-submit-btn { background: #16a34a; color: white; padding: 16px 50px; font-size: 19px; border-radius: 8px; font-weight: 600; }
        .final-submit-btn:hover { background: #15803d; transform: scale(1.05); }
        .step-indicator { display: flex; justify-content: center; margin-bottom: 35px; padding: 0 20px; }
        .step { display: flex; align-items: center; margin: 0 25px; }
        .step-circle { width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0; color: #64748b; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: bold; font-size: 16px; }
        .step.active .step-circle { background: #1a56db; color: white; }
        .step.completed .step-circle { background: #16a34a; color: white; }
        .step span { font-size: 16px; color: #475569; }
        .step.active span { color: #1a56db; font-weight: 500; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 9999; color: white; font-size: 20px; }
        @media (max-width: 768px) { .container { margin: 10px; } .text-content { padding: 20px 15px; max-height: 400px; } .step { margin: 0 10px; } .step span { font-size: 14px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ç¡®è®¤ç³»ç»Ÿ</h1>
            <p>è¯·ä»”ç»†é˜…è¯»å®ˆåˆ™å†…å®¹å¹¶å®Œæˆç­¾å­—ç¡®è®¤</p>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <span>é˜…è¯»å®ˆåˆ™</span>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <span>ç”µå­ç­¾å­—</span>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <span>ç¡®è®¤æäº¤</span>
            </div>
        </div>

        <div class="content-section">
            <div class="text-content" id="textContent">
                <h3>ååŒ—ç”µåŠ›å¤§å­¦æ§åˆ¶ä¸è®¡ç®—æœºå·¥ç¨‹å­¦é™¢é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™</h3>
                <p>äº²çˆ±çš„åŒå­¦ä»¬ï¼š</p>
                <p>å½“ç§‹æ„æ¸æµ“ï¼Œé“¶æå¶é“ºå°±æ ¡å›­çš„é‡‘é»„ï¼Œæˆ‘ä»¬è¿æ¥äº†é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•çš„æ£€éªŒæ—¶åˆ»ã€‚è¿™åœºè€ƒè¯•ä¸ä»…æ˜¯å¯¹åŠå­¦æœŸçŸ¥è¯†ç§¯ç´¯çš„å¤ç›˜ï¼Œæ›´æ˜¯å¯¹ç§‘å­¦ç²¾ç¥ä¸äººæ ¼å“è´¨çš„åŒé‡æ·¬ç‚¼ã€‚ä¸ºè¥é€ é£æ¸…æ°”æ­£çš„è€ƒè¯•æ°›å›´ï¼Œå®ˆæŠ¤æ¯ä¸€ä½åŒå­¦çš„ä»˜å‡ºä¸å°Šä¸¥ï¼Œå­¦é™¢ç‰¹å‘å¸ƒã€Šé«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ã€‹ï¼Œæ„¿æˆ‘ä»¬ä»¥ç¬”ä¸ºå‰‘ã€ä»¥è¯šç«‹èº«ï¼Œå…±åŒä¹¦å†™æ— æ„§äºå¿ƒçš„ç­”å·ã€‚</p>
                <h4>ä¸€ã€æ‰‹æœºä½¿ç”¨è§„èŒƒï¼šå·¥å…·ä¸ºå­¦ï¼Œè€ŒéæŠ•æœºä¹‹å™¨</h4>
                <p>æœ¬æ¬¡è€ƒè¯•å…è®¸æºå¸¦æ‰‹æœºï¼Œä½†ä»…é™æŸ¥çœ‹ç”µå­è¯•å·ï¼Œä¸¥ç¦ä»¥ä¸‹è¡Œä¸ºï¼š</p>
                <p><strong>ç¦ç”¨é€šè®¯åŠŸèƒ½</strong>ï¼šå…³é—­å¾®ä¿¡ã€QQã€çŸ­ä¿¡ç­‰ç¤¾äº¤è½¯ä»¶ï¼Œé€€å‡ºæ‰€æœ‰å­¦ä¹ ç±»APPï¼›</p>
                <p><strong>ç¦æ­¢æ‹æ‘„ä¼ é€’</strong>ï¼šä¸å¾—ç”¨æ‰‹æœºæ‹æ‘„è¯•å·ã€è‰ç¨¿çº¸æˆ–ç­”æ¡ˆï¼Œæ›´ä¸å¯é€šè¿‡æ‹ç…§ã€å½•å±ç­‰æ–¹å¼å‘åœºå¤–ä¼ é€’ä¿¡æ¯ï¼›</p>
                <p><strong>æœç»è¾…åŠ©è®¡ç®—</strong>ï¼šç¦æ­¢ä½¿ç”¨è®¡ç®—å™¨ç±»APPã€æ•°å­¦è§£é¢˜è½¯ä»¶æˆ–å…¶ä»–æ™ºèƒ½å·¥å…·è·å–è§£é¢˜æ­¥éª¤ï¼›</p>
                <p><strong>ä¸“æ³¨ç­”é¢˜åœºæ™¯</strong>ï¼šæ‰‹æœºéœ€æ”¾ç½®äºæ¡Œé¢å·¦ä¸Šè§’ï¼Œå…¨ç¨‹ä¿æŒå±å¹•æœä¸‹ï¼ŒéæŸ¥çœ‹é¢˜ç›®æ—¶ä¸å¾—è§¦ç¢°ã€‚</p>
                <h4>äºŒã€è¯šä¿¡ä¸ºæœ¬ï¼šä»¥çœŸæ‰å®å­¦ï¼Œèµ´é’æ˜¥ä¹‹çº¦</h4>
                <p>é«˜ç­‰æ•°å­¦ä½œä¸ºæ§åˆ¶ä¸è®¡ç®—æœºå­¦ç§‘çš„â€œåŸºçŸ³â€ï¼Œå…¶ä¸¥è°¨æ€§ä¸é€»è¾‘æ€§è´¯ç©¿ä¸“ä¸šå­¦ä¹ çš„å§‹ç»ˆã€‚è¯šä¿¡è€ƒè¯•ï¼Œæ—¢æ˜¯å¯¹çŸ¥è¯†çš„å°Šé‡ï¼Œæ›´æ˜¯å¯¹æœªæ¥çš„è´Ÿè´£ï¼š</p>
                <p><strong>æ‹’ç»ä¾¥å¹¸å¿ƒç†</strong>ï¼šä¸€é“é¢˜çš„æŠ„è¢­ã€ä¸€ä¸ªå…¬å¼çš„ç…§æ¬ï¼Œæˆ–è®¸èƒ½æš‚æ—¶æ©ç›–æ¼æ´ï¼Œå´ä¼šè®©ä½ åœ¨æœªæ¥çš„ä¸“ä¸šæŒ‘æˆ˜ä¸­å¤±å»åº•æ°”ï¼›</p>
                <p><strong>çè§†é›†ä½“è£èª‰</strong>ï¼šä¸€äººä½œå¼Šï¼ŒæŸå®³çš„æ˜¯æ•´ä¸ªå­¦é™¢çš„å­¦é£ï¼›äººäººå®ˆè¯ºï¼Œæ–¹èƒ½é“¸å°±â€œå­¦åœ¨ç”µé™¢â€çš„é‡‘å­—æ‹›ç‰Œï¼›</p>
                <h4>ä¸‰ã€è€ƒåœºçºªå¾‹ï¼šç»†èŠ‚è§å“æ ¼ï¼Œè§„åˆ™æŠ¤å…¬å¹³</h4>
                <p>â€¢ å‡­å­¦ç”Ÿè¯/æ ¡å›­å¡å…¥åœºï¼ŒæŒ‰æŒ‡å®šåº§ä½å°±åº§ï¼Œä¸å¾—æ“…è‡ªè°ƒæ¢ï¼›</p>
                <p>â€¢ å¼€è€ƒ15åˆ†é’Ÿåä¸å¾—å…¥åœºï¼Œå¼€è€ƒ60åˆ†é’Ÿå†…ä¸å¾—äº¤å·ç¦»åœºï¼›</p>
                <p>â€¢ é™¤å¿…è¦æ–‡å…·å¤–ï¼Œå…¶ä»–ç‰©å“ä¸€å¾‹æ”¾è‡³æŒ‡å®šåŒºåŸŸï¼›</p>
                <h4>å››ã€è¿è§„å¿…ç©¶ï¼šè«è®©ä¸€æ—¶ç³Šæ¶‚ï¼Œæ¯æ‰ä¸€ç”Ÿæ¸…èª‰</h4>
                <p>å­¦é™¢å°†ä»¥â€œé›¶å®¹å¿â€æ€åº¦ä¸¥è‚ƒå¤„ç†è¿è§„è¡Œä¸ºï¼š</p>
                <p>â€¢ å‡¡å‘ç°ä½œå¼Šè¡Œä¸ºï¼Œä¸€å¾‹æŒ‰ã€ŠååŒ—ç”µåŠ›å¤§å­¦å­¦ç”Ÿè¿çºªå¤„åˆ†è§„å®šã€‹ç»™äºˆè®°è¿‡åŠä»¥ä¸Šå¤„åˆ†ï¼Œå–æ¶ˆè¯¥è¯¾ç¨‹æˆç»©å¹¶è®°å…¥ä¸ªäººæ¡£æ¡ˆï¼›</p>
                <p style="text-align: right; margin-top: 30px; color: #666;">ååŒ—ç”µåŠ›å¤§å­¦æ§åˆ¶ä¸è®¡ç®—æœºå·¥ç¨‹å­¦é™¢<br>2025å¹´11æœˆ27æ—¥</p>
            </div>

            <button class="read-complete-btn" id="readCompleteBtn" onclick="showSignature()">
                æˆ‘å·²é˜…è¯»å®Œæ¯•ï¼Œè¿›å…¥ç­¾å­—
            </button>

            <div class="signature-section" id="signatureSection">
                <h2 class="signature-title">è¯·åœ¨ä¸‹æ–¹åŒºåŸŸç­¾ç½²æ‚¨çš„å§“å</h2>
                <div class="signature-area">
                    <canvas id="signatureCanvas" width="600" height="200"></canvas>
                </div>
                <div class="signature-controls">
                    <button class="btn clear-btn" onclick="clearSignature()">æ¸…é™¤ç­¾å­—</button>
                    <button class="btn" style="background: #16a34a; color: white;" onclick="completeSignature()">å®Œæˆç­¾å­—</button>
                </div>
            </div>

            <div class="submit-section" id="submitSection">
                <div class="confirmation-message">
                    <h3>âœ… ç­¾å­—å®Œæˆ</h3>
                    <p>æ‚¨å·²æˆåŠŸé˜…è¯»ã€Šé«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ã€‹å¹¶å®Œæˆç”µå­ç­¾å­—ï¼Œè¯·ç¡®è®¤æäº¤ä»¥å®Œæˆæ‰¿è¯ºæµç¨‹ã€‚</p>
                </div>
                <button class="btn final-submit-btn" onclick="finalSubmit()">ç¡®è®¤æäº¤æ‰¿è¯º</button>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div>æäº¤ä¸­... è¯·ç¨å€™</div>
    </div>

    <!-- 1. å¼•å…¥ LeanCloud JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.1/dist/av-min.js"></script>

    <script>
        let canvas, ctx;
        let isDrawing = false;
        let hasSignature = false;

        // ==========================================
        // 2. LeanCloud é…ç½® (å·²å¡«å…¥æ‚¨çš„ ID å’Œ Key)
        // ==========================================
        AV.init({
            appId: "v6tDMHtbS0q1Faaf1cNMELaP-gzGzoHsz",
            appKey: "VGsQLkmnTkqUYmOsMAdgeaKA",
            // âš ï¸ é‡è¦ï¼šè¯·æŒ‰ç…§ä¸‹æ–¹è¯´æ˜è·å–æ‚¨çš„ serverURL å¹¶æ›¿æ¢å¼•å·å†…çš„å†…å®¹
            serverURL: "https://v6tdmhtb.api.lncldglobal.com" 
        });

        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');
            const containerWidth = document.querySelector('.signature-area').offsetWidth;
            canvas.width = Math.min(600, containerWidth - 40);
            canvas.height = 200;
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            hasSignature = true;
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDrawing() { isDrawing = false; }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX, clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function showSignature() {
            document.getElementById('textContent').style.display = 'none';
            document.getElementById('readCompleteBtn').style.display = 'none';
            document.getElementById('signatureSection').style.display = 'block';
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            setTimeout(initCanvas, 100);
        }

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
        }

        function completeSignature() {
            if (!hasSignature) { alert('è¯·å…ˆè¿›è¡Œç­¾å­—å†ç»§ç»­ï¼'); return; }
            document.getElementById('signatureSection').style.display = 'none';
            document.getElementById('submitSection').style.display = 'block';
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
        }

        function finalSubmit() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            try {
                const signatureBase64 = canvas.toDataURL('image/png');
                const blob = dataURLToBlob(signatureBase64);
                const signatureFile = new AV.File(`signature_${new Date().getTime()}.png`, blob);

                signatureFile.save().then(uploadedFile => {
                    const signatureUrl = uploadedFile.url();
                    // è¿™é‡Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º 'HonestyCommitment' çš„è¡¨
                    const Commitment = AV.Object.extend('HonestyCommitment');
                    const commitment = new Commitment();
                    commitment.set('signatureUrl', signatureUrl);
                    commitment.set('submitTime', new Date());
                    commitment.set('status', 'å·²ç¡®è®¤');
                    commitment.set('device', getDeviceType());
                    return commitment.save();
                }).then(success => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    alert('ğŸ‰ æ‰¿è¯ºæäº¤æˆåŠŸï¼\n\næ‚¨å·²ç¡®è®¤éµå®ˆå®ˆåˆ™ï¼Œç­¾åä¿¡æ¯å·²ä¿å­˜ã€‚');
                }).catch(error => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    // å¸¸è§é”™è¯¯å¤„ç†æç¤º
                    if(error.message.includes("serverURL")) {
                        alert("æäº¤å¤±è´¥ï¼šè¯·åœ¨ä»£ç ä¸­å¡«å†™æ­£ç¡®çš„ serverURL (APIåŸŸå)");
                    } else {
                        alert(`æäº¤å¤±è´¥ï¼š${error.message}`);
                    }
                    console.error('å­˜å‚¨å¤±è´¥ï¼š', error);
                });
            } catch (error) {
                document.getElementById('loadingOverlay').style.display = 'none';
                alert(`æäº¤å¼‚å¸¸ï¼š${error.message}`);
            }
        }

        function dataURLToBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--) { u8arr[n] = bstr.charCodeAt(n); }
            return new Blob([u8arr], { type: mime });
        }

        function getDeviceType() {
            const userAgent = navigator.userAgent;
            return (/mobile|android|iphone|ipad|ipod/i.test(userAgent)) ? 'ç§»åŠ¨ç«¯' : 'PCç«¯';
        }

        window.onload = function() {
            window.addEventListener('resize', function() {
                if (document.getElementById('signatureSection').style.display === 'block') { initCanvas(); }
            });
        };
    </script>
</body>
</html>
