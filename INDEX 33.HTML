<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ç¡®è®¤ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.8;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a56db 0%, #1e3a8a 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .content-section {
            padding: 30px;
        }

        .text-content {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 16px;
        }

        .text-content h3 {
            color: #1e3a8a;
            text-align: center;
            margin-bottom: 25px;
            font-size: 22px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .text-content h4 {
            color: #1a56db;
            margin: 20px 0 15px 0;
            font-size: 18px;
            padding-left: 10px;
            border-left: 4px solid #1a56db;
        }

        .text-content p {
            margin-bottom: 15px;
            color: #444;
            text-indent: 2em;
            line-height: 1.8;
        }

        .text-content strong {
            color: #dc2626;
            font-weight: 600;
        }

        .read-complete-btn {
            display: block;
            width: 240px;
            margin: 30px auto 20px;
            padding: 14px 24px;
            background: #1a56db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .read-complete-btn:hover {
            background: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .signature-section {
            display: none;
            text-align: center;
            padding: 20px 0;
        }

        .signature-title {
            color: #333;
            margin-bottom: 25px;
            font-size: 21px;
        }

        .signature-area {
            border: 2px dashed #94a3b8;
            border-radius: 8px;
            margin: 20px auto;
            background: #f8fafc;
            width: 90%;
            max-width: 650px;
        }

        #signatureCanvas {
            display: block;
            margin: 0 auto;
            cursor: crosshair;
            border-radius: 6px;
        }

        .signature-controls {
            margin: 20px 0;
        }

        .btn {
            padding: 10px 22px;
            margin: 0 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .clear-btn {
            background: #ef4444;
            color: white;
        }

        .clear-btn:hover {
            background: #dc2626;
        }

        .submit-section {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .confirmation-message {
            background: #dcfce7;
            color: #166534;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #bbf7d0;
            font-size: 17px;
        }

        .final-submit-btn {
            background: #16a34a;
            color: white;
            padding: 16px 50px;
            font-size: 19px;
            border-radius: 8px;
            font-weight: 600;
        }

        .final-submit-btn:hover {
            background: #15803d;
            transform: scale(1.05);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 35px;
            padding: 0 20px;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 0 25px;
        }

        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 16px;
        }

        .step.active .step-circle {
            background: #1a56db;
            color: white;
        }

        .step.completed .step-circle {
            background: #16a34a;
            color: white;
        }

        .step span {
            font-size: 16px;
            color: #475569;
        }

        .step.active span {
            color: #1a56db;
            font-weight: 500;
        }

        /* æ–°å¢ï¼šä¸Šä¼ ä¸­åŠ è½½æç¤º */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .text-content {
                padding: 20px 15px;
                max-height: 400px;
            }
            
            .step {
                margin: 0 10px;
            }
            
            .step span {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ç¡®è®¤ç³»ç»Ÿ</h1>
            <p>è¯·ä»”ç»†é˜…è¯»å®ˆåˆ™å†…å®¹å¹¶å®Œæˆç­¾å­—ç¡®è®¤</p>
        </div>

        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <span>é˜…è¯»å®ˆåˆ™</span>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <span>ç”µå­ç­¾å­—</span>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <span>ç¡®è®¤æäº¤</span>
            </div>
        </div>

        <div class="content-section">
            <!-- æ–‡æ¡£é˜…è¯»åŒºåŸŸ -->
            <div class="text-content" id="textContent">
                <h3>ååŒ—ç”µåŠ›å¤§å­¦æ§åˆ¶ä¸è®¡ç®—æœºå·¥ç¨‹å­¦é™¢é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™</h3>
                
                <p>äº²çˆ±çš„åŒå­¦ä»¬ï¼š</p>
                
                <p>å½“ç§‹æ„æ¸æµ“ï¼Œé“¶æå¶é“ºå°±æ ¡å›­çš„é‡‘é»„ï¼Œæˆ‘ä»¬è¿æ¥äº†é«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•çš„æ£€éªŒæ—¶åˆ»ã€‚è¿™åœºè€ƒè¯•ä¸ä»…æ˜¯å¯¹åŠå­¦æœŸçŸ¥è¯†ç§¯ç´¯çš„å¤ç›˜ï¼Œæ›´æ˜¯å¯¹ç§‘å­¦ç²¾ç¥ä¸äººæ ¼å“è´¨çš„åŒé‡æ·¬ç‚¼ã€‚ä¸ºè¥é€ é£æ¸…æ°”æ­£çš„è€ƒè¯•æ°›å›´ï¼Œå®ˆæŠ¤æ¯ä¸€ä½åŒå­¦çš„ä»˜å‡ºä¸å°Šä¸¥ï¼Œå­¦é™¢ç‰¹å‘å¸ƒã€Šé«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ã€‹ï¼Œæ„¿æˆ‘ä»¬ä»¥ç¬”ä¸ºå‰‘ã€ä»¥è¯šç«‹èº«ï¼Œå…±åŒä¹¦å†™æ— æ„§äºå¿ƒçš„ç­”å·ã€‚</p>
                
                <h4>ä¸€ã€æ‰‹æœºä½¿ç”¨è§„èŒƒï¼šå·¥å…·ä¸ºå­¦ï¼Œè€ŒéæŠ•æœºä¹‹å™¨</h4>
                <p>æœ¬æ¬¡è€ƒè¯•å…è®¸æºå¸¦æ‰‹æœºï¼Œä½†ä»…é™æŸ¥çœ‹ç”µå­è¯•å·ï¼ˆå¦‚é€šè¿‡æŒ‡å®šå¹³å°æ¥æ”¶é¢˜ç›®ï¼‰ï¼Œä¸¥ç¦ä»¥ä¸‹è¡Œä¸ºï¼š</p>
                <p><strong>ç¦ç”¨é€šè®¯åŠŸèƒ½</strong>ï¼šå…³é—­å¾®ä¿¡ã€QQã€çŸ­ä¿¡ç­‰ç¤¾äº¤è½¯ä»¶ï¼Œé€€å‡ºæ‰€æœ‰å­¦ä¹ ç±»APPï¼ˆå¦‚æ‹ç…§æœé¢˜ã€åœ¨çº¿ç¿»è¯‘ã€å…¬å¼æŸ¥è¯¢å·¥å…·ï¼‰ï¼›</p>
                <p><strong>ç¦æ­¢æ‹æ‘„ä¼ é€’</strong>ï¼šä¸å¾—ç”¨æ‰‹æœºæ‹æ‘„è¯•å·ã€è‰ç¨¿çº¸æˆ–ç­”æ¡ˆï¼Œæ›´ä¸å¯é€šè¿‡æ‹ç…§ã€å½•å±ç­‰æ–¹å¼å‘åœºå¤–ä¼ é€’ä¿¡æ¯ï¼›</p>
                <p><strong>æœç»è¾…åŠ©è®¡ç®—</strong>ï¼šç¦æ­¢ä½¿ç”¨è®¡ç®—å™¨ç±»APPã€æ•°å­¦è§£é¢˜è½¯ä»¶ï¼ˆå¦‚Wolfram Alphaï¼‰æˆ–å…¶ä»–æ™ºèƒ½å·¥å…·è·å–è§£é¢˜æ­¥éª¤ï¼›</p>
                <p><strong>ä¸“æ³¨ç­”é¢˜åœºæ™¯</strong>ï¼šæ‰‹æœºéœ€æ”¾ç½®äºæ¡Œé¢å·¦ä¸Šè§’ï¼ˆç›‘è€ƒæ•™å¸ˆæŒ‡å®šä½ç½®ï¼‰ï¼Œå…¨ç¨‹ä¿æŒå±å¹•æœä¸‹ï¼ŒéæŸ¥çœ‹é¢˜ç›®æ—¶ä¸å¾—è§¦ç¢°ã€‚</p>
                <p>è¯·ç‰¢è®°ï¼šæ‰‹æœºæ˜¯å­¦ä¹ çš„å»¶ä¼¸ï¼Œè€ŒéæŠ•æœºçš„æ·å¾„ã€‚ä»»ä½•è¯•å›¾åˆ©ç”¨ç§‘æŠ€æ‰‹æ®µçªç ´è§„åˆ™çš„è¡Œä¸ºï¼Œéƒ½æ˜¯å¯¹å­¦æœ¯åº•çº¿çš„è·µè¸ã€‚</p>
                
                <h4>äºŒã€è¯šä¿¡ä¸ºæœ¬ï¼šä»¥çœŸæ‰å®å­¦ï¼Œèµ´é’æ˜¥ä¹‹çº¦</h4>
                <p>é«˜ç­‰æ•°å­¦ä½œä¸ºæ§åˆ¶ä¸è®¡ç®—æœºå­¦ç§‘çš„â€œåŸºçŸ³â€ï¼Œå…¶ä¸¥è°¨æ€§ä¸é€»è¾‘æ€§è´¯ç©¿ä¸“ä¸šå­¦ä¹ çš„å§‹ç»ˆã€‚è¯šä¿¡è€ƒè¯•ï¼Œæ—¢æ˜¯å¯¹çŸ¥è¯†çš„å°Šé‡ï¼Œæ›´æ˜¯å¯¹æœªæ¥çš„è´Ÿè´£ï¼š</p>
                <p><strong>æ‹’ç»ä¾¥å¹¸å¿ƒç†</strong>ï¼šä¸€é“é¢˜çš„æŠ„è¢­ã€ä¸€ä¸ªå…¬å¼çš„ç…§æ¬ï¼Œæˆ–è®¸èƒ½æš‚æ—¶æ©ç›–æ¼æ´ï¼Œå´ä¼šè®©ä½ åœ¨æœªæ¥çš„ä¸“ä¸šæŒ‘æˆ˜ä¸­å¤±å»åº•æ°”ï¼›</p>
                <p><strong>çè§†é›†ä½“è£èª‰</strong>ï¼šä¸€äººä½œå¼Šï¼ŒæŸå®³çš„æ˜¯æ•´ä¸ªå­¦é™¢çš„å­¦é£ï¼›äººäººå®ˆè¯ºï¼Œæ–¹èƒ½é“¸å°±â€œå­¦åœ¨ç”µé™¢â€çš„é‡‘å­—æ‹›ç‰Œï¼›</p>
                <p><strong>åšå®ˆäººæ ¼åº•è‰²</strong>ï¼šè¯šä¿¡æ˜¯æ¯”åˆ†æ•°æ›´é‡è¦çš„â€œå¿…ä¿®è¯¾â€ã€‚ä»Šæ—¥è€ƒåœºä¸Šçš„å¦è¡ï¼Œç»ˆå°†æˆä¸ºä½ æœªæ¥ç§‘ç ”æ”»å…³ã€èŒåœºç«äº‰ä¸­æœ€åšå®çš„åº•è‰²ã€‚</p>
                
                <h4>ä¸‰ã€è€ƒåœºçºªå¾‹ï¼šç»†èŠ‚è§å“æ ¼ï¼Œè§„åˆ™æŠ¤å…¬å¹³</h4>
                <p>é™¤æ‰‹æœºä½¿ç”¨å¤–ï¼Œè¯·ä¸¥æ ¼éµå®ˆä»¥ä¸‹è€ƒåœºè¦æ±‚ï¼š</p>
                <p>â€¢ å‡­å­¦ç”Ÿè¯/æ ¡å›­å¡å…¥åœºï¼ŒæŒ‰æŒ‡å®šåº§ä½å°±åº§ï¼Œä¸å¾—æ“…è‡ªè°ƒæ¢ï¼›</p>
                <p>â€¢ å¼€è€ƒ15åˆ†é’Ÿåä¸å¾—å…¥åœºï¼Œå¼€è€ƒ60åˆ†é’Ÿå†…ä¸å¾—äº¤å·ç¦»åœºï¼›</p>
                <p>â€¢ é™¤å¿…è¦æ–‡å…·ï¼ˆé»‘è‰²ç­¾å­—ç¬”ã€å°ºè§„ã€æ— å­˜å‚¨åŠŸèƒ½çš„è®¡ç®—å™¨ï¼‰å¤–ï¼Œå…¶ä»–ç‰©å“ï¼ˆå¦‚ä¹¦ç±ã€ç¬”è®°ã€ç”µå­è®¾å¤‡ï¼‰ä¸€å¾‹æ”¾è‡³æŒ‡å®šåŒºåŸŸï¼›</p>
                <p>â€¢ é‡è¯•å·å°åˆ·ä¸æ¸…ç­‰é—®é¢˜ï¼Œä¸¾æ‰‹ç¤ºæ„ç›‘è€ƒæ•™å¸ˆï¼Œä¸å¾—ç§è‡ªäº¤æµï¼›</p>
                <p>â€¢ äº¤å·åè¿…é€Ÿç¦»å¼€è€ƒåœºï¼Œä¸å¾—åœ¨èµ°å»Šã€æ•™å®¤é™„è¿‘é€—ç•™è®¨è®ºã€‚</p>
                
                <h4>å››ã€è¿è§„å¿…ç©¶ï¼šè«è®©ä¸€æ—¶ç³Šæ¶‚ï¼Œæ¯æ‰ä¸€ç”Ÿæ¸…èª‰</h4>
                <p>å­¦é™¢å°†ä»¥â€œé›¶å®¹å¿â€æ€åº¦ä¸¥è‚ƒå¤„ç†è¿è§„è¡Œä¸ºï¼š</p>
                <p>â€¢ å‡¡å‘ç°æºå¸¦æ‰‹æœºä½œå¼Šã€å¤¹å¸¦å°æŠ„ã€æ›¿è€ƒç­‰è¡Œä¸ºï¼Œä¸€å¾‹æŒ‰ã€ŠååŒ—ç”µåŠ›å¤§å­¦å­¦ç”Ÿè¿çºªå¤„åˆ†è§„å®šã€‹ç»™äºˆè®°è¿‡åŠä»¥ä¸Šå¤„åˆ†ï¼Œå–æ¶ˆè¯¥è¯¾ç¨‹æˆç»©å¹¶è®°å…¥ä¸ªäººæ¡£æ¡ˆï¼›</p>
                <p>â€¢ æƒ…èŠ‚ä¸¥é‡è€…ï¼ˆå¦‚ç»„ç»‡ä½œå¼Šã€ä¼ æ’­è¯•é¢˜ï¼‰ï¼Œå°†ç§»äº¤å­¦æ ¡ç›¸å…³éƒ¨é—¨å¤„ç†ï¼Œå¹¶ä¾æ³•è¿½ç©¶è´£ä»»ï¼›</p>
                <p>â€¢ ç›‘è€ƒæ•™å¸ˆå°†é€šè¿‡å·¡è€ƒã€ç›‘æ§å½•åƒæŠ½æŸ¥ç­‰æ–¹å¼å…¨ç¨‹ç›‘ç£ï¼Œç¡®ä¿è€ƒè¯•å…¬å¹³å…¬æ­£ã€‚</p>
                
                <p>åŒå­¦ä»¬ï¼Œé«˜ç­‰æ•°å­¦çš„é­…åŠ›åœ¨äºæ¢ç´¢çœŸç†çš„é€»è¾‘ä¹‹ç¾ï¼Œè€Œè¯šä¿¡åˆ™æ˜¯å¼€å¯è¿™æ‰‡å¤§é—¨çš„å”¯ä¸€é’¥åŒ™ã€‚å½“ä½ ä¼æ¡ˆç–¾ä¹¦æ—¶ï¼Œè¯·è®°ä½ï¼šæ¯ä¸€é“è®¤çœŸæ¨å¯¼çš„å…¬å¼ã€æ¯ä¸€æ¬¡ç‹¬ç«‹æ€è€ƒçš„çªç ´ï¼Œéƒ½æ˜¯å¯¹è‡ªå·±æœ€å¥½çš„å˜‰å¥–ã€‚</p>
                
                <p>æ„¿æˆ‘ä»¬ä»¥ç¬”ä¸ºåˆƒï¼ŒåŠˆå¼€æµ®èºçš„è¿·é›¾ï¼›ä»¥è¯šä¸ºç›¾ï¼Œå®ˆæŠ¤å­¦æœ¯çš„çº¯ç²¹ã€‚ç¥å…¨ä½“åŒå­¦åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­å±•ç°çœŸå®æ°´å¹³ï¼Œæ”¶è·çŸ¥è¯†ä¸å“æ ¼çš„åŒé‡æˆé•¿ï¼</p>
                
                <p style="text-align: right; margin-top: 30px; color: #666;">ååŒ—ç”µåŠ›å¤§å­¦æ§åˆ¶ä¸è®¡ç®—æœºå·¥ç¨‹å­¦é™¢<br>2025å¹´11æœˆ27æ—¥</p>
            </div>

            <button class="read-complete-btn" id="readCompleteBtn" onclick="showSignature()">
                æˆ‘å·²é˜…è¯»å®Œæ¯•ï¼Œè¿›å…¥ç­¾å­—
            </button>

            <!-- ç­¾å­—åŒºåŸŸ -->
            <div class="signature-section" id="signatureSection">
                <h2 class="signature-title">è¯·åœ¨ä¸‹æ–¹åŒºåŸŸç­¾ç½²æ‚¨çš„å§“å</h2>
                <div class="signature-area">
                    <canvas id="signatureCanvas" width="600" height="200"></canvas>
                </div>
                <div class="signature-controls">
                    <button class="btn clear-btn" onclick="clearSignature()">æ¸…é™¤ç­¾å­—</button>
                    <button class="btn" style="background: #16a34a; color: white;" onclick="completeSignature()">å®Œæˆç­¾å­—</button>
                </div>
            </div>

            <!-- ç¡®è®¤æäº¤åŒºåŸŸ -->
            <div class="submit-section" id="submitSection">
                <div class="confirmation-message">
                    <h3>âœ… ç­¾å­—å®Œæˆ</h3>
                    <p>æ‚¨å·²æˆåŠŸé˜…è¯»ã€Šé«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ã€‹å¹¶å®Œæˆç”µå­ç­¾å­—ï¼Œè¯·ç¡®è®¤æäº¤ä»¥å®Œæˆæ‰¿è¯ºæµç¨‹ã€‚</p>
                </div>
                <button class="btn final-submit-btn" onclick="finalSubmit()">ç¡®è®¤æäº¤æ‰¿è¯º</button>
            </div>
        </div>
    </div>

    <!-- ä¸Šä¼ ä¸­åŠ è½½æç¤º -->
    <div class="loading-overlay" id="loadingOverlay">
        <div>æäº¤ä¸­... è¯·ç¨å€™</div>
    </div>

    <!-- 1. å¼•å…¥ LeanCloud JS SDKï¼ˆå¿…é¡»æ”¾åœ¨æœ€å‰é¢ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.1/dist/av-min.js"></script>

    <script>
        let canvas, ctx;
        let isDrawing = false;
        let hasSignature = false;

        // 2. åˆå§‹åŒ– LeanCloudï¼ˆå·²å¡«å…¥ä½ çš„ App ID å’Œ App Keyï¼Œä»…éœ€è¡¥å…… serverURLï¼‰
        AV.init({
            appId: "gSt5JvCJddyc0Gil0qHrtMia-gzGzoHsz",  // å·²å¡«å…¥ä½ çš„ App ID
            appKey: "JEDmkSemSAZ5hdQXMsqQ8ELP",          // å·²å¡«å…¥ä½ çš„ App Key
            serverURL: "è¯·æ›¿æ¢ä¸ºä½ çš„LeanCloudåº”ç”¨åŸŸå"   // â—ï¸å¿…é¡»æ›¿æ¢ï¼šLeanCloud â†’ åº”ç”¨ â†’ äº‘å¼•æ“ â†’ éƒ¨ç½² â†’ é»˜è®¤è®¿é—®åŸŸå
        });

        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');
            
            // å“åº”å¼è°ƒæ•´ç”»å¸ƒå¤§å°
            const containerWidth = document.querySelector('.signature-area').offsetWidth;
            canvas.width = Math.min(600, containerWidth - 40);
            canvas.height = 200;
            
            // è®¾ç½®ç”»å¸ƒæ ·å¼
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // é¼ æ ‡äº‹ä»¶
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯æ”¯æŒï¼‰
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        // å¼€å§‹ç»˜åˆ¶
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            hasSignature = true;
        }

        // ç»˜åˆ¶
        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        // åœæ­¢ç»˜åˆ¶
        function stopDrawing() {
            isDrawing = false;
        }

        // å¤„ç†è§¦æ‘¸äº‹ä»¶
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        // æ˜¾ç¤ºç­¾å­—åŒºåŸŸ
        function showSignature() {
            document.getElementById('textContent').style.display = 'none';
            document.getElementById('readCompleteBtn').style.display = 'none';
            document.getElementById('signatureSection').style.display = 'block';
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            
            // åˆå§‹åŒ–ç”»å¸ƒ
            setTimeout(initCanvas, 100);
        }

        // æ¸…é™¤ç­¾å­—
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
        }

        // å®Œæˆç­¾å­—
        function completeSignature() {
            if (!hasSignature) {
                alert('è¯·å…ˆè¿›è¡Œç­¾å­—å†ç»§ç»­ï¼');
                return;
            }
            
            document.getElementById('signatureSection').style.display = 'none';
            document.getElementById('submitSection').style.display = 'block';
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
        }

        // æœ€ç»ˆæäº¤ï¼ˆæ ¸å¿ƒï¼šLeanCloud å­˜å‚¨é€»è¾‘ï¼‰
        function finalSubmit() {
            // æ˜¾ç¤ºåŠ è½½æç¤º
            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                // 1. å°† Canvas ç­¾åè½¬ä¸º Base64 å›¾ç‰‡
                const signatureBase64 = canvas.toDataURL('image/png'); // è½¬ä¸º PNG æ ¼å¼çš„ Base64

                // 2. ä¸Šä¼ å›¾ç‰‡åˆ° LeanCloud æ–‡ä»¶å­˜å‚¨
                const blob = dataURLToBlob(signatureBase64); // Base64 è½¬ Blob
                const signatureFile = new AV.File(`signature_${new Date().getTime()}.png`, blob);

                // 3. å…ˆä¸Šä¼ å›¾ç‰‡ï¼Œå†å­˜å‚¨ä¿¡æ¯åˆ°ç»“æ„åŒ–æ•°æ®
                signatureFile.save().then(uploadedFile => {
                    // å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œè·å–å›¾ç‰‡ URL
                    const signatureUrl = uploadedFile.url();

                    // 4. åˆ›å»ºç»“æ„åŒ–æ•°æ®å¯¹è±¡ï¼ˆå­˜å‚¨åˆ° LeanCloud çš„ Class ä¸­ï¼‰
                    const Commitment = AV.Object.extend('HonestyCommitment'); // Class åç§°ï¼šHonestyCommitmentï¼ˆéœ€åœ¨ LeanCloud æå‰åˆ›å»ºï¼‰
                    const commitment = new Commitment();

                    // 5. è®¾ç½®è¦å­˜å‚¨çš„å­—æ®µï¼ˆå¯æ ¹æ®éœ€è¦æ–°å¢ï¼Œå¦‚å­¦å·ã€å§“åç­‰ï¼‰
                    commitment.set('signatureUrl', signatureUrl); // ç­¾åå›¾ç‰‡ URL
                    commitment.set('submitTime', new Date()); // æäº¤æ—¶é—´ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
                    commitment.set('status', 'å·²ç¡®è®¤'); // æäº¤çŠ¶æ€
                    commitment.set('device', getDeviceType()); // æäº¤è®¾å¤‡ï¼ˆPC/ç§»åŠ¨ç«¯ï¼‰

                    // 6. ä¿å­˜æ•°æ®åˆ° LeanCloud
                    return commitment.save();
                }).then(success => {
                    // æäº¤æˆåŠŸ
                    document.getElementById('loadingOverlay').style.display = 'none';
                    alert('ğŸ‰ æ‰¿è¯ºæäº¤æˆåŠŸï¼\n\næ‚¨å·²ç¡®è®¤éµå®ˆã€Šé«˜ç­‰æ•°å­¦æœŸä¸­è€ƒè¯•è¯šä¿¡å®ˆåˆ™ã€‹ï¼Œç­¾åä¿¡æ¯å·²ä¿å­˜ã€‚\né¢„ç¥è€ƒè¯•é¡ºåˆ©ï¼Œå±•ç°çœŸå®æ°´å¹³ï¼');
                    // å¯é€‰ï¼šæäº¤åè·³è½¬é¡µé¢ï¼ˆå¦‚è¿”å›é¦–é¡µï¼‰
                    // window.location.href = 'https://ä½ çš„GitHub Pagesé¦–é¡µ';
                }).catch(error => {
                    // æäº¤å¤±è´¥
                    document.getElementById('loadingOverlay').style.display = 'none';
                    alert(`æäº¤å¤±è´¥ï¼š${error.message}\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ– LeanCloud é…ç½®æ˜¯å¦æ­£ç¡®`);
                    console.error('å­˜å‚¨å¤±è´¥ï¼š', error);
                });
            } catch (error) {
                document.getElementById('loadingOverlay').style.display = 'none';
                alert(`æäº¤å¼‚å¸¸ï¼š${error.message}`);
            }
        }

        // è¾…åŠ©å‡½æ•°ï¼šBase64 è½¬ Blobï¼ˆç”¨äºä¸Šä¼ å›¾ç‰‡ï¼‰
        function dataURLToBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // è¾…åŠ©å‡½æ•°ï¼šè·å–è®¾å¤‡ç±»å‹ï¼ˆPC/ç§»åŠ¨ç«¯ï¼‰
        function getDeviceType() {
            const userAgent = navigator.userAgent;
            if (/mobile|android|iphone|ipad|ipod/i.test(userAgent)) {
                return 'ç§»åŠ¨ç«¯';
            } else {
                return 'PCç«¯';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // é€‚é…ç§»åŠ¨ç«¯ç”»å¸ƒå¤§å°
            window.addEventListener('resize', function() {
                if (document.getElementById('signatureSection').style.display === 'block') {
                    initCanvas();
                }
            });
        };
    </script>
</body>
</html>